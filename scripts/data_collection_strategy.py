#!/usr/bin/env python3
"""
下一代数据采集策略 - 多源扩展方案
用于Cron Job自动发现新餐厅
"""

# ============================================
# 当前采集策略 (Phase 1 - 基础覆盖)
# ============================================

CURRENT_STRATEGY = {
    "方法": "地域关键词搜索 + 亚洲餐筛选",
    "覆盖地区": [
        "Mountain View", "Palo Alto", "Cupertino", "Sunnyvale",
        "San Jose", "Fremont", "Milpitas", "Union City", "Santa Clara",
        "南湾", "东湾", "半岛", "旧金山", "湾区"
    ],
    "搜索词模板": "{地区}美食",
    "筛选规则": {
        "包含": "亚洲菜系关键词",
        "排除": "非亚洲菜系"
    },
    "当前数据": "82个posts, 76家餐厅",
    "覆盖率": "南湾核心区约60-70%"
}

# ============================================
# 扩展策略 (Phase 2 - 深度发现)
# ============================================

EXPANSION_STRATEGIES = {
    
    "策略1: 增加卫星城市覆盖": {
        "新增地区": [
            # 南湾扩展
            "Los Gatos美食", "Saratoga美食", "Campbell美食",
            "Los Altos美食", "Menlo Park美食", "Redwood City美食",
            
            # 东湾扩展  
            "Newark美食", "Hayward美食", "San Leandro美食",
            "Oakland美食", "Berkeley美食", "Walnut Creek美食",
            "Dublin美食", "Pleasanton美食", "Livermore美食",
            
            # 半岛扩展
            "San Mateo美食", "Burlingame美食", "Millbrae美食",
            "San Bruno美食", "South San Francisco美食",
            
            # 旧金山扩展
            "San Francisco美食", "SF中餐", "SF日料", "SF韩餐"
        ],
        "预期增量": "30-50家新餐厅",
        "优先级": "高"
    },
    
    "策略2: 菜系垂直搜索": {
        "搜索词": [
            # 中餐细分
            "湾区川菜", "湾区湘菜", "湾区粤菜", "湾区火锅",
            "湾区烧烤", "湾区早茶", "湾区点心", "湾区拉面",
            "湾区麻辣烫", "湾区麻辣香锅", "湾区云南菜",
            "湾区新疆菜", "湾区东北菜", "湾区台湾菜",
            
            # 日料
            "湾区日料", "湾区寿司", "湾区日式拉面", "湾区烧鸟",
            "湾区寿喜烧", "湾区和牛",
            
            # 韩餐
            "湾区韩餐", "湾区韩式烤肉", "湾区韩国炸鸡",
            "湾区石锅拌饭", "湾区部队锅",
            
            # 东南亚
            "湾区泰国菜", "湾区泰餐", "湾区越南菜", "湾区pho",
            "湾区新加坡菜", "湾区海南鸡饭", "湾区马来西亚菜",
            
            # 其他亚洲
            "湾区印度菜", "湾区咖喱"
        ],
        "方法": "直接搜索菜系，突破地域限制",
        "预期增量": "20-30家新餐厅",
        "优先级": "高"
    },
    
    "策略3: 场景化搜索": {
        "搜索词": [
            "湾区约会餐厅", "湾区聚餐", "湾区家庭聚餐",
            "湾区一人食", "湾区工作餐", "湾区夜宵",
            "湾区生日餐厅", "湾区庆祝", "湾区商务宴请",
            "湾区便宜好吃", "湾区性价比", "湾区必吃",
            "湾区网红餐厅", "湾区隐藏美食", "湾区local推荐"
        ],
        "方法": "按用餐场景搜索，发现特色餐厅",
        "预期增量": "15-25家新餐厅",
        "优先级": "中"
    },
    
    "策略4: 从评论中挖掘": {
        "方法": "分析已有posts的评论，发现被提及但未记录的餐厅",
        "触发条件": "每周分析一次所有comments",
        "预期增量": "5-10家/周",
        "优先级": "中"
    },
    
    "策略5: 连锁餐厅补全": {
        "已知连锁": [
            "海底捞", "快乐小羊", "滋味小面", "章台柳",
            "鲜芋仙", "85度C", "巴黎贝甜", "黄记煌",
            "鼎泰丰", "Denny's", "Apple Green Bistro"
        ],
        "方法": "搜索连锁名+湾区各城市，发现遗漏分店",
        "预期增量": "10-15家",
        "优先级": "低"
    },
    
    "策略6: 热点追踪": {
        "触发条件": "检测到高engagement帖子(>1000 likes)",
        "自动操作": "优先采集该post详情和comments",
        "方法": "实时监控Xiaohongshu热门内容",
        "预期增量": "动态发现",
        "优先级": "高"
    }
}

# ============================================
# Cron Job扩展配置
# ============================================

CRON_SCHEDULE = {
    "每日任务": {
        "时间": "02:00",
        "任务": "基础增量更新",
        "范围": "监控已有餐厅的新提及",
        "预计新增": "0-2家/天"
    },
    
    "每周任务": {
        "时间": "周日 03:00",
        "任务": "深度发现",
        "策略": ["策略2: 菜系垂直搜索", "策略4: 评论挖掘"],
        "预计新增": "5-10家/周"
    },
    
    "每月任务": {
        "时间": "每月1日 04:00",
        "任务": "大范围扩展",
        "策略": ["策略1: 卫星城市", "策略3: 场景化搜索"],
        "预计新增": "20-30家/月"
    },
    
    "实时监控": {
        "触发": "高engagement帖子(>500 likes in 24h)",
        "任务": "热点追踪",
        "策略": "策略6",
        "响应时间": "<1小时"
    }
}

# ============================================
# 数据质量控制
# ============================================

QUALITY_CONTROLS = {
    "去重规则": [
        "同一餐厅多个posts → 合并engagement",
        "连锁餐厅不同分店 → 分别记录",
        "同名不同店 → 用地址区分"
    ],
    
    "验证规则": [
        "新餐厅必须有Google Places验证",
        "engagement < 10的餐厅暂缓入库",
        "连续30天无新提及的餐厅标记为'inactive'"
    ],
    
    "增量限制": [
        "每周最多新增50家（避免质量下降）",
        "新餐厅必须有至少1个高质量post(engagement>50)",
        "卫星城市餐厅需有Google评分>3.5"
    ]
}

# ============================================
# 目标里程碑
# ============================================

TARGETS = {
    "2026年3月": {
        "总餐厅数": "150家",
        "覆盖城市": "15个",
        "策略": "策略1 + 策略2"
    },
    
    "2026年6月": {
        "总餐厅数": "250家",
        "覆盖城市": "25个",
        "策略": "全部策略"
    },
    
    "2026年底": {
        "总餐厅数": "400家",
        "覆盖范围": "整个旧金山湾区",
        "数据维度": "餐厅 + 菜品 + 价格 + 营业时间"
    }
}

if __name__ == "__main__":
    print("🎯 数据采集策略 v2.0")
    print("=" * 60)
    print(f"\n当前策略: {CURRENT_STRATEGY['方法']}")
    print(f"当前数据: {CURRENT_STRATEGY['当前数据']}")
    print(f"\n扩展策略数量: {len(EXPANSION_STRATEGIES)}")
    print("\n目标:")
    for date, target in TARGETS.items():
        print(f"  {date}: {target['总餐厅数']}家餐厅")
