#!/usr/bin/env python3
"""
æœç´¢ç­–ç•¥è½®æ¢æœºåˆ¶
æ¯å‘¨è‡ªåŠ¨è½®æ¢æœç´¢è¯ï¼Œç¡®ä¿è¦†ç›–å¹¿åº¦
"""

import json
from datetime import datetime, timedelta

# ============================================
# è½®æ¢è¯åº“
# ============================================

SCENE_QUERIES = {
    # å‘¨ä¸€è½®æ¢
    "å‘¨ä¸€": [
        "æ¹¾åŒºçº¦ä¼šé¤å…", "æ¹¾åŒºæƒ…ä¾£é¤å…", "æ¹¾åŒºæµªæ¼«é¤å…",
        "æ¹¾åŒºç”Ÿæ—¥é¤å…", "æ¹¾åŒºçºªå¿µæ—¥é¤å…", "æ¹¾åŒºè¡¨ç™½é¤å…"
    ],
    # å‘¨äºŒè½®æ¢
    "å‘¨äºŒ": [
        "æ¹¾åŒºå®¶åº­èšé¤", "æ¹¾åŒºå¸¦å­©å­åƒé¥­", "æ¹¾åŒºäº²å­é¤å…",
        "æ¹¾åŒºè€äººçˆ±åƒ", "æ¹¾åŒºé€‚åˆå…¨å®¶", "æ¹¾åŒºå›¢åœ†é¥­"
    ],
    # å‘¨ä¸‰è½®æ¢
    "å‘¨ä¸‰": [
        "æ¹¾åŒºä¸€äººé£Ÿ", "æ¹¾åŒºç‹¬è‡ªåƒé¥­", "æ¹¾åŒºå·¥ä½œé¤",
        "æ¹¾åŒºç®€é¤", "æ¹¾åŒºå¿«é¤", "æ¹¾åŒº lunch"
    ],
    # å‘¨å››è½®æ¢
    "å‘¨å››": [
        "æ¹¾åŒºæœ‹å‹èšé¤", "æ¹¾åŒºåŒäº‹èšé¤", "æ¹¾åŒºåŒå­¦èšä¼š",
        "æ¹¾åŒºè¯·å®¢åƒé¥­", "æ¹¾åŒºèšé¤å¥½å»å¤„"
    ],
    # å‘¨äº”è½®æ¢
    "å‘¨äº”": [
        "æ¹¾åŒºå‘¨æœ«èšé¤", "æ¹¾åŒºå‘¨äº”èšé¤", "æ¹¾åŒºæ”¾æ¾åƒé¥­",
        "æ¹¾åŒºçŠ’åŠ³è‡ªå·±", "æ¹¾åŒºå‘¨æœ«åƒå•¥"
    ],
    # å‘¨å…­è½®æ¢
    "å‘¨å…­": [
        "æ¹¾åŒºå¿…åƒ", "æ¹¾åŒºç½‘çº¢é¤å…", "æ¹¾åŒºlocalæ¨è",
        "æ¹¾åŒºå®è—é¤å…", "æ¹¾åŒºéšè—ç¾é£Ÿ", "æ¹¾åŒºä¸åƒåæ‚”"
    ],
    # å‘¨æ—¥è½®æ¢
    "å‘¨æ—¥": [
        "æ¹¾åŒºé¿é›·", "æ¹¾åŒºè¸©é›·", "æ¹¾åŒºé¿å‘",
        "æ¹¾åŒºä¸å€¼å¾—", "æ¹¾åŒº overrated", "æ¹¾åŒºåæ§½"
    ]
}

CUISINE_QUERIES = {
    # ä¸­é¤ç»†åˆ† (ç¬¬1å‘¨)
    "ä¸­é¤å‘¨1": ["æ¹¾åŒºå·èœ", "æ¹¾åŒºæ¹˜èœ", "æ¹¾åŒºç²¤èœ", "æ¹¾åŒºç«é”…"],
    # ä¸­é¤ç»†åˆ† (ç¬¬2å‘¨)
    "ä¸­é¤å‘¨2": ["æ¹¾åŒºçƒ§çƒ¤", "æ¹¾åŒºæ—©èŒ¶", "æ¹¾åŒºç‚¹å¿ƒ", "æ¹¾åŒºæ‹‰é¢"],
    # æ—¥æ–™ (ç¬¬3å‘¨)
    "æ—¥æ–™å‘¨": ["æ¹¾åŒºæ—¥æ–™", "æ¹¾åŒºå¯¿å¸", "æ¹¾åŒºæ—¥å¼æ‹‰é¢", "æ¹¾åŒºçƒ§é¸Ÿ", "æ¹¾åŒºå¯¿å–œçƒ§"],
    # éŸ©é¤+ä¸œå—äºš (ç¬¬4å‘¨)
    "éŸ©ä¸œå—äºšå‘¨": ["æ¹¾åŒºéŸ©é¤", "æ¹¾åŒºæ³°å›½èœ", "æ¹¾åŒºè¶Šå—èœ", "æ¹¾åŒºpho", "æ¹¾åŒºæ–°åŠ å¡èœ"],
}

SATELLITE_CITIES = {
    # ç¬¬1å‘¨: å—æ¹¾æ‰©å±•
    "å—æ¹¾æ‰©å±•": [
        "Los Gatosç¾é£Ÿ", "Saratogaç¾é£Ÿ", "Campbellç¾é£Ÿ",
        "Los Altosç¾é£Ÿ", "Menlo Parkç¾é£Ÿ"
    ],
    # ç¬¬2å‘¨: åŠå²›æ‰©å±•
    "åŠå²›æ‰©å±•": [
        "Redwood Cityç¾é£Ÿ", "San Mateoç¾é£Ÿ", "Burlingameç¾é£Ÿ",
        "Millbraeç¾é£Ÿ", "San Brunoç¾é£Ÿ"
    ],
    # ç¬¬3å‘¨: ä¸œæ¹¾æ‰©å±•
    "ä¸œæ¹¾æ‰©å±•": [
        "Newarkç¾é£Ÿ", "Haywardç¾é£Ÿ", "San Leandroç¾é£Ÿ",
        "Oaklandç¾é£Ÿ", "Berkeleyç¾é£Ÿ"
    ],
    # ç¬¬4å‘¨: è¿œéƒŠ+SF
    "è¿œéƒŠSF": [
        "Dublinç¾é£Ÿ", "Pleasantonç¾é£Ÿ", "Walnut Creekç¾é£Ÿ",
        "San Franciscoç¾é£Ÿ", "SFä¸­é¤"
    ]
}

def get_week_of_month():
    """è·å–å½“å‰æ˜¯ç¬¬å‡ å‘¨ (1-4)ï¼Œè¶…è¿‡4å‘¨å¾ªç¯å›ç¬¬1å‘¨"""
    now = datetime.now()
    day_of_month = now.day
    # è®¡ç®—å‘¨æ•°ï¼Œä½†æœ€å¤š4å‘¨ï¼Œç¬¬5å‘¨+å›é€€åˆ°ç¬¬1å‘¨
    week = (day_of_month - 1) // 7 + 1
    return ((week - 1) % 4) + 1  # 1-4å¾ªç¯

def get_weekday():
    """è·å–ä»Šå¤©æ˜¯å‘¨å‡  (å‘¨ä¸€=0, å‘¨æ—¥=6)"""
    return datetime.now().weekday()

def get_today_queries():
    """è·å–ä»Šå¤©çš„æœç´¢è¯"""
    weekday = get_weekday()
    week_of_month = get_week_of_month()
    
    # å‘¨å‡ åç§°
    weekday_names = ["å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­", "å‘¨æ—¥"]
    weekday_name = weekday_names[weekday]
    
    queries = []
    
    # 1. åœºæ™¯æœç´¢ (æ¯å¤©è½®æ¢)
    scene_list = SCENE_QUERIES.get(weekday_name, ["æ¹¾åŒºç¾é£Ÿ"])
    # æ¯å¤©é€‰2ä¸ªåœºæ™¯è¯
    queries.extend(scene_list[:2])
    
    # 2. èœç³»æœç´¢ (æ¯å‘¨è½®æ¢)
    cuisine_week_keys = ["ä¸­é¤å‘¨1", "ä¸­é¤å‘¨2", "æ—¥æ–™å‘¨", "éŸ©ä¸œå—äºšå‘¨"]
    cuisine_key = cuisine_week_keys[(week_of_month - 1) % 4]
    cuisine_list = CUISINE_QUERIES.get(cuisine_key, ["æ¹¾åŒºäºšæ´²èœ"])
    # æ¯å‘¨é€‰2ä¸ªèœç³»è¯
    queries.extend(cuisine_list[:2])
    
    # 3. å«æ˜ŸåŸå¸‚ (æ¯å‘¨è½®æ¢)
    city_week_keys = ["å—æ¹¾æ‰©å±•", "åŠå²›æ‰©å±•", "ä¸œæ¹¾æ‰©å±•", "è¿œéƒŠSF"]
    city_key = city_week_keys[(week_of_month - 1) % 4]
    city_list = SATELLITE_CITIES.get(city_key, ["æ¹¾åŒºç¾é£Ÿ"])
    # æ¯å‘¨é€‰2ä¸ªåŸå¸‚
    queries.extend(city_list[:2])
    
    return {
        "weekday": weekday_name,
        "week_of_month": week_of_month,
        "scene": scene_list[:2],
        "cuisine": cuisine_list[:2],
        "cities": city_list[:2],
        "all_queries": queries
    }

if __name__ == "__main__":
    result = get_today_queries()
    
    print("ğŸ¯ ä»Šæ—¥æœç´¢ç­–ç•¥")
    print("=" * 60)
    print(f"ä»Šå¤©æ˜¯: {result['weekday']} (ç¬¬{result['week_of_month']}å‘¨)")
    print("")
    print("åœºæ™¯æœç´¢:")
    for q in result['scene']:
        print(f"  â€¢ {q}")
    print("")
    print("èœç³»æœç´¢:")
    for q in result['cuisine']:
        print(f"  â€¢ {q}")
    print("")
    print("å«æ˜ŸåŸå¸‚:")
    for q in result['cities']:
        print(f"  â€¢ {q}")
    print("")
    print(f"ä»Šæ—¥å…± {len(result['all_queries'])} ä¸ªæœç´¢è¯")
