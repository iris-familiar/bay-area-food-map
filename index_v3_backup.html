<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¹¾åŒºç¾é£Ÿåœ°å›¾ V3 | å®æ—¶æ•°æ®ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto+Sans+SC', -apple-system, sans-serif; background: #F5F5F7; }
        .card-hover { transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0,0,0,0.08); }
        .glass { background: rgba(255,255,255,0.92); backdrop-filter: saturate(180%) blur(20px); }
        .gradient-text { background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .status-recommended { border-left: 3px solid #34C759; }
        .status-not-recommended { border-left: 3px solid #FF3B30; }
        .status-warning { border-left: 3px solid #FF9500; }
        .filter-active { background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%); color: white !important; }
        .sentiment-high { background: linear-gradient(135deg, #34C759 0%, #30D158 100%); }
        .sentiment-mid { background: linear-gradient(135deg, #FF9500 0%, #FFCC00 100%); }
        .sentiment-low { background: linear-gradient(135deg, #FF3B30 0%, #FF453A 100%); }
        .line-clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="sticky top-0 z-50 glass border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-orange-500 rounded-xl flex items-center justify-center text-white text-2xl">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold gradient-text">æ¹¾åŒºç¾é£Ÿåœ°å›¾ V3</h1>
                        <p class="text-sm text-gray-500">å®æ—¶æ•°æ® Â· è‡ªåŠ¨åˆ·æ–°</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-sm text-gray-600">
                        <span id="total-restaurants" class="font-bold text-blue-600">--</span> å®¶é¤å…
                    </span>
                    <button onclick="toggleStats()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm">
                        <i class="fas fa-chart-bar mr-2"></i>ç»Ÿè®¡
                    </button>
                    <button onclick="loadData()" class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-sm">
                        <i class="fas fa-sync-alt"></i> åˆ·æ–°
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Loading State -->
        <div id="loading" class="text-center py-20">
            <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-500">æ­£åœ¨åŠ è½½æœ€æ–°æ•°æ®...</p>
        </div>

        <!-- Content -->
        <div id="content" class="hidden">
            
            <!-- Stats Panel -->
            <div id="stats-panel" class="hidden bg-white rounded-2xl shadow-sm p-6 mb-6">
                <h2 class="text-lg font-bold mb-4">ğŸ“Š æ•°æ®æ´å¯Ÿ</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 text-center">
                        <div class="text-3xl font-bold text-green-600" id="stat-recommended">0</div>
                        <div class="text-sm text-gray-600">æ¨èé¤å…</div>
                    </div>
                    <div class="bg-gradient-to-br from-red-50 to-rose-50 rounded-xl p-4 text-center">
                        <div class="text-3xl font-bold text-red-600" id="stat-not-recommended">0</div>
                        <div class="text-sm text-gray-600">é¿é›·é¤å…</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 text-center">
                        <div class="text-3xl font-bold text-blue-600" id="stat-verified">0</div>
                        <div class="text-sm text-gray-600">å·²éªŒè¯</div>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-4 text-center">
                        <div class="text-3xl font-bold text-yellow-600" id="stat-avg-rating">0</div>
                        <div class="text-sm text-gray-600">å¹³å‡è¯„åˆ†</div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="bg-white rounded-2xl shadow-sm p-4 mb-6">
                <div class="flex flex-wrap gap-2 mb-3">
                    <span class="text-gray-600 text-sm py-2">èœç³»ï¼š</span>
                    <button onclick="filterByType('all')" class="filter-btn filter-active px-3 py-1.5 rounded-full bg-gray-100 text-sm transition" data-type="all">å…¨éƒ¨</button>
                    <button onclick="filterByType('æ¹˜èœ')" class="filter-btn px-3 py-1.5 rounded-full bg-gray-100 text-sm transition" data-type="æ¹˜èœ">ğŸ”¥ æ¹˜èœ</button>
                    <button onclick="filterByType('å·èœ')" class="filter-btn px-3 py-1.5 rounded-full bg-gray-100 text-sm transition" data-type="å·èœ">ğŸŒ¶ï¸ å·èœ</button>
                    <button onclick="filterByType('ä¸œåŒ—èœ')" class="filter-btn px-3 py-1.5 rounded-full bg-gray-100 text-sm transition" data-type="ä¸œåŒ—èœ">ğŸ¥˜ ä¸œåŒ—èœ</button>
                    <button onclick="filterByType('æ—¥æ–™')" class="filter-btn px-3 py-1.5 rounded-full bg-gray-100 text-sm transition" data-type="æ—¥æ–™">ğŸ£ æ—¥æ–™</button>
                    <button onclick="filterByType('ç«é”…')" class="filter-btn px-3 py-1.5 rounded-full bg-gray-100 text-sm transition" data-type="ç«é”…">ğŸ² ç«é”…</button>
                </div>
                
                <div class="flex gap-2">
                    <input type="text" id="search-input" placeholder="æœç´¢é¤å…ã€èœå“ã€åœ°å€..." 
                           class="flex-1 px-4 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                           onkeyup="if(event.key==='Enter') searchRestaurants()">
                    <select id="sort-select" onchange="sortRestaurants()" class="px-3 py-2 border rounded-lg text-sm bg-white">
                        <option value="discussion-desc">ğŸ”¥ è®¨è®ºåº¦ (é«˜ â†’ ä½)</option>
                        <option value="sentiment-desc">ğŸ˜Š æƒ…æ„Ÿåˆ† (é«˜ â†’ ä½)</option>
                        <option value="trend-desc">ğŸ“ˆ è¶‹åŠ¿ (å‡ â†’ é™)</option>
                        <option value="rating-desc">â­ Googleè¯„åˆ† (é«˜ â†’ ä½)</option>
                        <option value="name-asc">ğŸ·ï¸ åç§° (A â†’ Z)</option>
                    </select>
                    
                    <button onclick="toggleSortDirection()" id="sort-direction-btn" class="px-3 py-2 border rounded-lg bg-gray-50 hover:bg-gray-100">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </div>
            </div>

            <!-- Top Performers -->
            <div class="bg-white rounded-2xl shadow-sm p-6 mb-6">
                <h2 class="text-lg font-bold mb-4">ğŸ† æœ¬å‘¨äº®ç‚¹</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-4">
                        <div class="text-sm text-gray-600 mb-1">è®¨è®ºåº¦å† å†›</div>
                        <div class="font-bold text-lg" id="top-discussion">-</div>
                        <div class="text-sm text-yellow-600" id="top-discussion-val">0 äº’åŠ¨</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4">
                        <div class="text-sm text-gray-600 mb-1">å£ç¢‘æœ€ä½³</div>
                        <div class="font-bold text-lg" id="top-sentiment">-</div>
                        <div class="text-sm text-green-600" id="top-sentiment-val">0.0 åˆ†</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4">
                        <div class="text-sm text-gray-600 mb-1">ä¸Šå‡æœ€å¿«</div>
                        <div class="font-bold text-lg" id="top-trend">-</div>
                        <div class="text-sm text-blue-600" id="top-trend-val">+0%</div>
                    </div>
                </div>
            </div>

            <!-- Restaurant Grid -->
            <div id="restaurant-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Cards will be inserted here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="hidden text-center py-16">
                <div class="text-6xl mb-4">ğŸœ</div>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¤å…</h3>
                <p class="text-gray-500">è¯•ç€è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æœç´¢å…¶ä»–å…³é”®è¯</p>
            </div>

            <!-- Glossary -->
            <div class="bg-white rounded-2xl shadow-sm p-6 mt-8">
                <h2 class="text-lg font-bold mb-4">ğŸ“– Metrics & æœ¯è¯­æŒ‡å—</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                    <div>
                        <h3 class="font-semibold mb-2">ğŸ”¥ è®¨è®ºåº¦ (Discussion Volume)</h3>
                        <p class="text-gray-600">è¡¡é‡é¤å…åœ¨ç¤¾äº¤åª’ä½“ä¸Šçš„è¢«è®¨è®ºé¢‘ç‡ã€‚æ€»äº’åŠ¨é‡ = å¸–å­æ•° + è¯„è®ºæ•°</p>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold mb-2">ğŸ˜Š æƒ…æ„Ÿåˆ†æ (Sentiment Analysis)</h3>
                        <p class="text-gray-600">åˆ†æè¯„è®ºå†…å®¹çš„æƒ…æ„Ÿå€¾å‘ï¼Œåˆ†æ•°èŒƒå›´ 0-1ã€‚0.85+æå¥½ï¼Œ0.7+æ­£é¢ï¼Œ0.5+æ··åˆï¼Œ<0.5è´Ÿé¢</p>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold mb-2">ğŸ“ˆ è¶‹åŠ¿åˆ†æ (Trend Analysis)</h3>
                        <p class="text-gray-600">æ¯”è¾ƒè¿‘æœŸä¸æ—©æœŸçš„è®¨è®ºé‡å˜åŒ–ã€‚ğŸ“ˆä¸Šå‡(+20%)ã€â¡ï¸ç¨³å®šã€ğŸ“‰ä¸‹é™(-20%)</p>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold mb-2">âœ“ éªŒè¯çŠ¶æ€</h3>
                        <p class="text-gray-600">âœ…æ¨èï¼šè¯„ä»·è‰¯å¥½ | âŒé¿é›·ï¼šè´¨é‡é—®é¢˜ | âœ“GoogleéªŒè¯ï¼šåœ°å€è¯„åˆ†å·²æ ¸å®</p>
                    </div>
                </div>
                
                <div class="mt-4 pt-4 border-t text-center text-sm text-gray-500">
                    <p>æœ€åæ›´æ–°: 2026-02-15 | æ•°æ®ç‰ˆæœ¬: v3.0 | è‡ªåŠ¨åˆ·æ–°: 30ç§’</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Detail Modal -->
    <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
                <h3 id="modal-title" class="text-xl font-bold"></h3>
                <button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modal-content" class="p-6">
                <!-- Content inserted by JS -->
            </div>
        </div>
    </div>

    <script>
        // Global State
        let restaurants = [];
        let filteredRestaurants = [];
        let currentFilter = { type: 'all' };

        // Load Data from JSON - REALTIME
        async function loadData() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('content').classList.add('hidden');
            
            try {
                // Try to load from JSON file with cache-busting
                const response = await fetch('data/current/restaurant_database.json?v=' + Date.now());
                
                if (response.ok) {
                    const data = await response.json();
                    restaurants = data.restaurants || [];
                    console.log('âœ… Loaded from JSON:', restaurants.length, 'restaurants');
                } else {
                    console.log('âš ï¸ JSON not found, using embedded data');
                    restaurants = getEmbeddedData();
                }
            } catch (e) {
                console.log('âš ï¸ Error loading JSON:', e);
                restaurants = getEmbeddedData();
            }
            
            filteredRestaurants = [...restaurants];
            
            // Update UI
            document.getElementById('total-restaurants').textContent = restaurants.length;
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            
            updateStats();
            updateTopPerformers();
            renderRestaurants();
        }

        // Embedded Fallback Data
        function getEmbeddedData() {
            return [
                {
                    id: "r001", name: "é¦™é”…å¤§ç‹", name_en: "Sizzling Pot King", type: "æ¹˜èœ", 
                    area: "æ—§é‡‘å±±", location: "SF", address: "139 8th St, San Francisco, CA 94103", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.0, google_place_id: "ChIJYZp9LYOAhYAR-zYOp1qMPbE",
                    metrics: {
                        discussion_volume: { total_engagement: 31, mention_count: 15 },
                        sentiment_analysis: { score: 0.85, positive_mentions: 12 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 0 }
                    },
                    highlights: ["æ¹˜èœ", "é¦™é”…", "é”…æ°”è¶³"],
                    recommendations: ["é¦™é”…"],
                    sources: ["68c74123"]
                },
                {
                    id: "r002", name: "ç‹å®¶å‘³", name_en: "Wang Jia Wei", type: "ä¸œåŒ—èœ",
                    area: "ä¸œæ¹¾", location: "Union City", address: "1743 Decoto Rd, Union City, CA 94587", price_range: "$",
                    status: "recommended", verified: true, google_rating: 3.9, google_place_id: "ChIJiSTpNGKVj4ARESrDVqxm6uM",
                    metrics: {
                        discussion_volume: { total_engagement: 75, mention_count: 22 },
                        sentiment_analysis: { score: 0.68, positive_mentions: 15 },
                        trend_over_time: { trend_direction: "rising", trend_percentage: 35 }
                    },
                    highlights: ["ä¸œåŒ—èœ", "é”…åŒ…è‚‰", "é…¸èœç™½è‚‰"],
                    recommendations: ["é”…åŒ…è‚‰", "é…¸èœç™½è‚‰"],
                    sources: ["68c74123"]
                },
                {
                    id: "r003", name: "Tamarine Restaurant", name_en: "Tamarine Restaurant & Gallery", type: "è¶Šå—èœ",
                    area: "åŠå²›", location: "Palo Alto", address: "546 University Ave, Palo Alto, CA 94301", price_range: "$$$",
                    status: "recommended", verified: true, google_rating: 4.5, google_place_id: "ChIJwWcdxzi7j4ARSPpV37nhr58",
                    metrics: {
                        discussion_volume: { total_engagement: 2, mention_count: 1 },
                        sentiment_analysis: { score: 0.95, positive_mentions: 1 },
                        trend_over_time: { trend_direction: "rising", trend_percentage: 25 }
                    },
                    recommendations: ["taro root rollsæ˜¥å·", "crab tacos", "tiger prawns & garlic noodles"],
                    highlights: ["åƒäº†å…«æ¬¡çš„å®è—é¤å…", "Palo Alto downtown"],
                    sources: ["6940e1dc"]
                },
                {
                    id: "r004", name: "Shoji", name_en: "Shoji", type: "æ—¥æ–™",
                    area: "æ—§é‡‘å±±", location: "SF", address: "140 New Montgomery St #1, San Francisco, CA 94105", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.2, google_place_id: "ChIJN_JxeQCBhYAR6LTP2YCkTDE",
                    metrics: {
                        discussion_volume: { total_engagement: 3, mention_count: 1 },
                        sentiment_analysis: { score: 0.92, positive_mentions: 1 },
                        trend_over_time: { trend_direction: "rising", trend_percentage: 40 }
                    },
                    recommendations: ["æµ·èƒ†é¥­", "sweet shrimp miso soup"],
                    highlights: ["æµ·èƒ†é²œç”œ", "é±¼ç±½å’¸é²œ", "ç”œè™¾è½¯ç³¯"],
                    sources: ["6927f249"]
                },
                {
                    id: "r005", name: "Z&Y Restaurant", name_en: "Z&Y", type: "å·èœ",
                    area: "æ—§é‡‘å±±", location: "SF Chinatown", address: "655 Jackson St, San Francisco, CA 94133", price_range: "$$",
                    status: "not_recommended", verified: true, google_rating: 4.1, google_place_id: "ChIJmevPu_SAhYARMmQlHRt_Rj4",
                    metrics: {
                        discussion_volume: { total_engagement: 48, mention_count: 18 },
                        sentiment_analysis: { score: 0.25, positive_mentions: 2, negative_mentions: 13 },
                        trend_over_time: { trend_direction: "declining", trend_percentage: -45 }
                    },
                    warnings: ["è´¨é‡ä¸‹é™", "çƒ‚å®Œäº†"],
                    sources: ["68c74123"]
                },
                {
                    id: "r006", name: "Mikiya", name_en: "Mikiya Wagyu Shabu House", type: "ç«é”…",
                    area: "å—æ¹¾", location: "Santa Clara", address: "3590 Homestead Rd, Santa Clara, CA 95051", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.7, google_place_id: "ChIJVe_0K9m1j4AR2DRSXeB8LH8",
                    metrics: {
                        discussion_volume: { total_engagement: 1, mention_count: 1 },
                        sentiment_analysis: { score: 0.90, positive_mentions: 1 },
                        trend_over_time: { trend_direction: "rising", trend_percentage: 35 }
                    },
                    highlights: ["æ¹¾åŒºé£Ÿç‰©è’æ¼ æ—¶æœŸå”¯ä¸€æ•‘æ˜Ÿ"],
                    sources: ["693764ec"]
                },
                {
                    id: "r007", name: "ç•™æ¹˜", name_en: "Ping's Bistro", type: "æ¹˜èœ",
                    area: "å—æ¹¾", location: "Cupertino", address: "10700 S De Anza Blvd, Cupertino, CA 95014", price_range: "$$$",
                    status: "recommended", verified: true, google_rating: 4.4, google_place_id: "ChIJg42-9rm1j4ARwBn9d3bdDYA",
                    metrics: {
                        discussion_volume: { total_engagement: 468, mention_count: 45 },
                        sentiment_analysis: { score: 0.68, positive_mentions: 28, negative_mentions: 9 },
                        trend_over_time: { trend_direction: "rising", trend_percentage: 45 }
                    },
                    highlights: ["æ¹–å—èœ", "äº‘å—èœ", "Cupertino"],
                    sources: ["6927f249", "6949f1c8", "6972f9c6"]
                },
                {
                    id: "r008", name: "é¡¾æ¹˜", name_en: "Hometown Kitchen", type: "æ¹˜èœ",
                    area: "å—æ¹¾", location: "Milpitas", address: "1245 Jacklin Rd, Milpitas, CA 95035", price_range: "$",
                    status: "recommended", verified: true, google_rating: 4.2, google_place_id: "ChIJc4j6WTrPj4ARI9gStcFY8Ro",
                    metrics: {
                        discussion_volume: { total_engagement: 54, mention_count: 12 },
                        sentiment_analysis: { score: 0.78, positive_mentions: 9 },
                        trend_over_time: { trend_direction: "rising", trend_percentage: 55 }
                    },
                    highlights: ["æ¹–å—èœ", "Milpitas", "äººå‡60"],
                    sources: ["6927f249"]
                },
                {
                    id: "r009", name: "Noren Izakaya", name_en: "Noren Izakaya", type: "æ—¥æ–™",
                    area: "æ—§é‡‘å±±", location: "SF", address: "1701 Powell St, San Francisco, CA 94133", price_range: "$",
                    status: "recommended", verified: true, google_rating: 4.2,
                    metrics: {
                        discussion_volume: { total_engagement: 2 },
                        sentiment_analysis: { score: 0.78 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 5 }
                    }
                },
                {
                    id: "r010", name: "æ¨è£•å…´", name_en: "Yum Noodles", type: "æ¹˜èœ",
                    area: "å—æ¹¾", location: "Santa Clara", address: "5223 Stevens Creek Blvd, Santa Clara, CA 95051", price_range: "$",
                    status: "recommended", verified: true, google_rating: 4.3,
                    metrics: {
                        discussion_volume: { total_engagement: 3 },
                        sentiment_analysis: { score: 0.82 },
                        trend_over_time: { trend_direction: "rising", trend_percentage: 30 }
                    }
                },
                {
                    id: "r011", name: "é˜¿æ‹‰ä¸Šæµ·", name_en: "I Shanghai Delight", type: "ä¸Šæµ·èœ",
                    area: "ä¸œæ¹¾", location: "Fremont", address: "6016 Stevenson Blvd, Fremont, CA 94538", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.3,
                    metrics: {
                        discussion_volume: { total_engagement: 2 },
                        sentiment_analysis: { score: 0.80 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 0 }
                    }
                },
                {
                    id: "r012", name: "Shanghai Flavor", name_en: "Shanghai Flavor", type: "ä¸Šæµ·èœ",
                    area: "ä¸œæ¹¾", location: "Fremont", address: "46132 Warm Springs Blvd, Fremont, CA 94539", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.1,
                    metrics: {
                        discussion_volume: { total_engagement: 5 },
                        sentiment_analysis: { score: 0.75 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 5 }
                    }
                },
                {
                    id: "r013", name: "Katsu Gin", name_en: "Katsu Gin", type: "æ—¥æ–™",
                    area: "å—æ¹¾", location: "Milpitas", address: "128 N Milpitas Blvd, Milpitas, CA 95035", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.0,
                    metrics: {
                        discussion_volume: { total_engagement: 1 },
                        sentiment_analysis: { score: 0.60 },
                        trend_over_time: { trend_direction: "declining", trend_percentage: -10 }
                    }
                },
                {
                    id: "r014", name: "Wooga Gamjatang", name_en: "Wooga Korean BBQ", type: "éŸ©é¤",
                    area: "å—æ¹¾", location: "Cupertino", address: "10493 S De Anza Blvd, Cupertino, CA 95014", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.4,
                    metrics: {
                        discussion_volume: { total_engagement: 2 },
                        sentiment_analysis: { score: 0.85 },
                        trend_over_time: { trend_direction: "rising", trend_percentage: 20 }
                    }
                },
                {
                    id: "r015", name: "Ushiya AYCE", name_en: "Ushiya AYCE", type: "éŸ©é¤",
                    area: "", location: "", address: "", price_range: "",
                    status: "recommended", verified: false, google_rating: null,
                    metrics: {
                        discussion_volume: { total_engagement: 1 },
                        sentiment_analysis: { score: 0.65 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 0 }
                    }
                },
                {
                    id: "r016", name: "Kunjip Tofu", name_en: "Kunjip Tofu", type: "éŸ©é¤",
                    area: "å—æ¹¾", location: "Mountain View", address: "1962 El Camino Real, Mountain View, CA 94040", price_range: "$$$",
                    status: "recommended", verified: true, google_rating: 4.2,
                    metrics: {
                        discussion_volume: { total_engagement: 1 },
                        sentiment_analysis: { score: 0.78 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 0 }
                    }
                },
                {
                    id: "r017", name: "Indo Restaurant", name_en: "INDO Restaurant & Lounge", type: "ä¸œå—äºšèœ",
                    area: "åŠå²›", location: "Palo Alto", address: "3295 El Camino Real, Palo Alto, CA 94306", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.3,
                    metrics: {
                        discussion_volume: { total_engagement: 1 },
                        sentiment_analysis: { score: 0.80 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 5 }
                    }
                },
                {
                    id: "r018", name: "Das Bierhauz", name_en: "Das Bierhauz", type: "å¾·é¤",
                    area: "å—æ¹¾", location: "Mountain View", address: "135 Castro St, Mountain View, CA 94041", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.3,
                    metrics: {
                        discussion_volume: { total_engagement: 1 },
                        sentiment_analysis: { score: 0.82 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 10 }
                    }
                },
                {
                    id: "r019", name: "Cali Spartan Mexican Kitchen", name_en: "Cali Spartan Mexican Kitchen", type: "å¢¨è¥¿å“¥èœ",
                    area: "å—æ¹¾", location: "San Jose", address: "515 S 10th St, San Jose, CA 95112", price_range: "$-$$",
                    status: "recommended", verified: true, google_rating: 4.3,
                    metrics: {
                        discussion_volume: { total_engagement: 1 },
                        sentiment_analysis: { score: 0.75 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 5 }
                    }
                },
                {
                    id: "r020", name: "Acekingéº»è¾£çƒ«", name_en: "Aceking", type: "éº»è¾£çƒ«",
                    area: "ä¸œæ¹¾", location: "Newark", address: "6062 Mowry Ave, Newark, CA 94560", price_range: "$",
                    status: "recommended", verified: true, google_rating: 4.0,
                    metrics: {
                        discussion_volume: { total_engagement: 2 },
                        sentiment_analysis: { score: 0.80 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 0 }
                    }
                },
                {
                    id: "r021", name: "å¡”é‡Œæœ¨", name_en: "Tarim Garden", type: "æ–°ç–†èœ",
                    area: "å—æ¹¾", location: "Santa Clara", address: "2135 El Camino Real, Santa Clara, CA 95050", price_range: "$$",
                    status: "recommended", verified: true, google_rating: 4.4,
                    metrics: {
                        discussion_volume: { total_engagement: 2 },
                        sentiment_analysis: { score: 0.85 },
                        trend_over_time: { trend_direction: "stable", trend_percentage: 0 }
                    }
                }
            ];
        }

        // Update Stats
        function updateStats() {
            const recommended = restaurants.filter(r => r.status === 'recommended').length;
            const notRecommended = restaurants.filter(r => r.status === 'not_recommended').length;
            const verified = restaurants.filter(r => r.verified).length;
            const avgRating = restaurants.length > 0 
                ? (restaurants.reduce((a, r) => a + (r.google_rating || 0), 0) / restaurants.length).toFixed(1)
                : 0;
            
            document.getElementById('stat-recommended').textContent = recommended;
            document.getElementById('stat-not-recommended').textContent = notRecommended;
            document.getElementById('stat-verified').textContent = verified;
            document.getElementById('stat-avg-rating').textContent = avgRating;
        }

        // Update Top Performers
        function updateTopPerformers() {
            if (restaurants.length === 0) return;
            
            const byDiscussion = [...restaurants].sort((a, b) => 
                (b.metrics?.discussion_volume?.total_engagement || 0) - 
                (a.metrics?.discussion_volume?.total_engagement || 0));
            
            const bySentiment = [...restaurants].sort((a, b) => 
                (b.metrics?.sentiment_analysis?.score || 0) - 
                (a.metrics?.sentiment_analysis?.score || 0));
            
            const byTrend = [...restaurants].sort((a, b) => 
                (b.metrics?.trend_over_time?.trend_percentage || 0) - 
                (a.metrics?.trend_over_time?.trend_percentage || 0));
            
            if (byDiscussion[0]) {
                document.getElementById('top-discussion').textContent = byDiscussion[0].name;
                document.getElementById('top-discussion-val').textContent = 
                    (byDiscussion[0].metrics?.discussion_volume?.total_engagement || 0) + ' äº’åŠ¨';
            }
            
            if (bySentiment[0]) {
                document.getElementById('top-sentiment').textContent = bySentiment[0].name;
                document.getElementById('top-sentiment-val').textContent = 
                    (bySentiment[0].metrics?.sentiment_analysis?.score || 0).toFixed(2) + ' åˆ†';
            }
            
            if (byTrend[0]) {
                document.getElementById('top-trend').textContent = byTrend[0].name;
                document.getElementById('top-trend-val').textContent = '+' + 
                    (byTrend[0].metrics?.trend_over_time?.trend_percentage || 0) + '%';
            }
        }

        // Render Cards
        function renderRestaurants() {
            const grid = document.getElementById('restaurant-grid');
            const emptyState = document.getElementById('empty-state');
            
            if (filteredRestaurants.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            grid.innerHTML = filteredRestaurants.map(r => {
                const sentiment = r.metrics?.sentiment_analysis?.score || 0.5;
                const trend = r.metrics?.trend_over_time?.trend_direction || 'stable';
                const trendPct = r.metrics?.trend_over_time?.trend_percentage || 0;
                const engagement = r.metrics?.discussion_volume?.total_engagement || 0;
                
                const sentimentClass = sentiment >= 0.85 ? 'sentiment-high' : sentiment >= 0.6 ? 'sentiment-mid' : 'sentiment-low';
                const statusClass = r.status === 'recommended' ? 'status-recommended' : 
                                   r.status === 'not_recommended' ? 'status-not-recommended' : 'status-warning';
                const trendIcon = trend === 'rising' ? 'ğŸ“ˆ' : trend === 'declining' ? 'ğŸ“‰' : 'â¡ï¸';
                const trendColor = trend === 'rising' ? 'text-green-600' : trend === 'declining' ? 'text-red-600' : 'text-gray-500';
                
                return `
                    <div class="bg-white rounded-2xl shadow-sm overflow-hidden card-hover ${statusClass} cursor-pointer" onclick="showDetail('${r.id}')">
                        <div class="p-4">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex-1 min-w-0">
                                    <h3 class="font-bold text-gray-900 truncate">${r.name}</h3>
                                    <p class="text-xs text-gray-500 truncate">${r.name_en}</p>
                                </div>
                                <div class="flex items-center gap-1">
                                    ${r.verified ? '<span class="px-2 py-0.5 bg-blue-50 text-blue-600 text-xs rounded-full">âœ“ å·²éªŒè¯</span>' : ''}
                                </div>
                            </div>
                            
                            <div class="flex gap-1.5 mb-2">
                                <span class="px-2 py-0.5 bg-red-50 text-red-600 text-xs rounded font-medium">${r.type}</span>
                                <span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded">${r.area}</span>
                                <span class="px-2 py-0.5 bg-yellow-50 text-yellow-700 text-xs rounded">${r.price_range}</span>
                            </div>
                            
                            <p class="text-xs text-gray-500 mb-3 truncate">${r.address}</p>
                            
                            <div class="grid grid-cols-4 gap-1 text-center">
                                <div class="bg-gray-50 rounded p-1.5">
                                    <div class="text-[10px] text-gray-400">è®¨è®ºåº¦</div>
                                    <div class="text-sm font-bold">${engagement}</div>
                                </div>
                                <div class="bg-gray-50 rounded p-1.5">
                                    <div class="text-[10px] text-gray-400">æƒ…æ„Ÿ</div>
                                    <span class="px-1.5 py-0.5 ${sentimentClass} text-white text-xs rounded">${sentiment.toFixed(2)}</span>
                                </div>
                                <div class="bg-gray-50 rounded p-1.5">
                                    <div class="text-[10px] text-gray-400">è¶‹åŠ¿</div>
                                    <div class="text-sm font-bold ${trendColor}">${trendIcon} ${trendPct > 0 ? '+' : ''}${trendPct}%</div>
                                </div>
                                <div class="bg-gray-50 rounded p-1.5">
                                    <div class="text-[10px] text-gray-400">Google</div>
                                    <div class="text-sm font-bold">â­${r.google_rating || '-'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Show Detail Modal
        function showDetail(id) {
            const r = restaurants.find(x => x.id === id);
            if (!r) return;
            
            const modal = document.getElementById('detail-modal');
            document.getElementById('modal-title').textContent = r.name;
            
            const m = r.metrics || {};
            const sentiment = m.sentiment_analysis || {};
            
            document.getElementById('modal-content').innerHTML = `
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm">${r.type}</span>
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">${r.area}</span>
                        <span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm">${r.price_range}</span>
                        ${r.verified ? '<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">âœ“ GoogleéªŒè¯</span>' : ''}
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-1">ğŸ“ åœ°å€</h4>
                        ${r.address ? `
                            <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(r.name + ' ' + r.address)}" 
                               target="_blank" class="text-blue-600 hover:underline flex items-center gap-2">
                                <i class="fas fa-map-marker-alt"></i>${r.address}
                                <i class="fas fa-external-link-alt text-xs"></i>
                            </a>
                        ` : '<p class="text-gray-500">æš‚æ— åœ°å€</p>'}
                        ${r.google_rating ? `<p class="text-sm text-gray-500 mt-1">â­ Googleè¯„åˆ†: ${r.google_rating}</p>` : ''}
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl p-4">
                        <h4 class="font-semibold mb-3">ğŸ“Š Metrics</h4>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-red-600">${m.discussion_volume?.total_engagement || 0}</div>
                                <div class="text-xs text-gray-600">è®¨è®ºåº¦</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold ${sentiment.score >= 0.7 ? 'text-green-600' : 'text-yellow-600'}">${(sentiment.score || 0).toFixed(2)}</div>
                                <div class="text-xs text-gray-600">æƒ…æ„Ÿåˆ†</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold ${(m.trend_over_time?.trend_direction === 'rising') ? 'text-green-600' : 'text-gray-600'}">${m.trend_over_time?.trend_percentage || 0}%</div>
                                <div class="text-xs text-gray-600">è¶‹åŠ¿</div>
                            </div>
                        </div>
                    </div>
                    
                    ${r.recommendations?.length ? `
                        <div>
                            <h4 class="font-semibold mb-2">ğŸ‘¨â€ğŸ³ æ¨èèœå“</h4>
                            <div class="flex flex-wrap gap-2">
                                ${r.recommendations.map(dish => `<span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm">${dish}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${r.warnings?.length ? `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                            <h4 class="font-semibold text-yellow-800 mb-1">âš ï¸ æ³¨æ„äº‹é¡¹</h4>
                            <ul class="list-disc list-inside text-sm text-yellow-700">
                                ${r.warnings.map(w => `<li>${w}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${r.correction ? `
                        <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                            <h4 class="font-semibold text-blue-800 mb-1">â„¹ï¸ æ›´æ­£ä¿¡æ¯</h4>
                            <p class="text-sm text-blue-700">${r.correction}</p>
                        </div>
                    ` : ''}
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('detail-modal').classList.add('hidden');
        }

        function toggleStats() {
            const panel = document.getElementById('stats-panel');
            panel.classList.toggle('hidden');
        }

        // Filter Functions
        function filterByType(type) {
            currentFilter.type = type;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.type === type) btn.classList.add('filter-active');
                else btn.classList.remove('filter-active');
            });
            
            if (type === 'all') {
                filteredRestaurants = [...restaurants];
            } else {
                filteredRestaurants = restaurants.filter(r => r.type === type);
            }
            
            renderRestaurants();
        }

        function searchRestaurants() {
            const query = document.getElementById('search-input').value.toLowerCase();
            if (!query) {
                filterByType(currentFilter.type);
                return;
            }
            filteredRestaurants = restaurants.filter(r => 
                r.name.toLowerCase().includes(query) ||
                r.name_en.toLowerCase().includes(query) ||
                r.address?.toLowerCase().includes(query)
            );
            renderRestaurants();
        }

        // Sort state
        let currentSort = { field: 'discussion', direction: 'desc' };

        function toggleSortDirection() {
            const btn = document.getElementById('sort-direction-btn');
            const icon = btn.querySelector('i');
            
            if (currentSort.direction === 'desc') {
                currentSort.direction = 'asc';
                icon.className = 'fas fa-arrow-up';
            } else {
                currentSort.direction = 'desc';
                icon.className = 'fas fa-arrow-down';
            }
            
            sortRestaurants();
        }

        function sortRestaurants() {
            const sortValue = document.getElementById('sort-select').value;
            currentSort.field = sortValue.replace('-desc', '').replace('-asc', '');
            
            const isAsc = currentSort.direction === 'asc';
            
            filteredRestaurants.sort((a, b) => {
                let valA, valB;
                
                switch(currentSort.field) {
                    case 'discussion':
                        valA = a.metrics?.discussion_volume?.total_engagement || 0;
                        valB = b.metrics?.discussion_volume?.total_engagement || 0;
                        break;
                    case 'sentiment':
                        valA = a.metrics?.sentiment_analysis?.score || 0;
                        valB = b.metrics?.sentiment_analysis?.score || 0;
                        break;
                    case 'trend':
                        valA = a.metrics?.trend_over_time?.trend_percentage || 0;
                        valB = b.metrics?.trend_over_time?.trend_percentage || 0;
                        break;
                    case 'rating':
                        valA = a.google_rating || 0;
                        valB = b.google_rating || 0;
                        break;
                    case 'name':
                        return isAsc ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name);
                    default:
                        return 0;
                }
                
                return isAsc ? valA - valB : valB - valA;
            });
            
            renderRestaurants();
        }

        // Apply current filters without resetting UI
        function applyCurrentFilters() {
            // Apply type filter
            if (currentFilter.type !== 'all') {
                filteredRestaurants = restaurants.filter(r => r.type === currentFilter.type);
            } else {
                filteredRestaurants = [...restaurants];
            }
            
            // Apply search filter if exists
            const query = document.getElementById('search-input').value.toLowerCase();
            if (query) {
                filteredRestaurants = filteredRestaurants.filter(r => 
                    r.name.toLowerCase().includes(query) ||
                    r.name_en.toLowerCase().includes(query) ||
                    r.address?.toLowerCase().includes(query)
                );
            }
            
            // Re-apply sort
            sortRestaurants();
            
            // Update stats
            document.getElementById('total-restaurants').textContent = restaurants.length;
            updateStats();
            updateTopPerformers();
        }

        // Auto-load
        document.addEventListener('DOMContentLoaded', loadData);
        // Refresh every 1 minute without resetting filters
        setInterval(() => {
            fetch('data/current/restaurant_database.json?v=' + Date.now())
                .then(r => r.json())
                .then(data => {
                    restaurants = data.restaurants || [];
                    // Re-apply current filters without resetting UI
                    applyCurrentFilters();
                    console.log('ğŸ”„ Auto-refreshed:', restaurants.length, 'restaurants');
                })
                .catch(e => console.log('Refresh failed:', e));
        }, 60000);
    </script>
</body>
</html>