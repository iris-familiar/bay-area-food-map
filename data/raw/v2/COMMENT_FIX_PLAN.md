# è¯„è®ºæ•°æ®IDå­—æ®µä¿®å¤è®¡åˆ’

## å½“å‰çŠ¶æ€ (2026-02-16)

### éªŒè¯ç»“æœ
```
æ€»æ–‡ä»¶æ•°: 21
æœ‰æ•ˆæ–‡ä»¶: 6 (28.6%)
æ— æ•ˆæ–‡ä»¶: 15 (71.4%)

æ€»è¯„è®ºæ•°: 119
æœ‰IDçš„è¯„è®º: 19 (16.0%)
æ— IDçš„è¯„è®º: 100 (84.0%)

æ€»å›å¤æ•°: 61
æœ‰IDçš„å›å¤: 9 (14.8%)
```

### é—®é¢˜åŸå› 
åŸå§‹é‡‡é›†è„šæœ¬ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µåï¼š
- âŒ é”™è¯¯: `commentId` (ä¸å­˜åœ¨)
- âœ… æ­£ç¡®: `id` (å®é™…å­—æ®µå)

åŒæ—¶ä½œè€…ä¿¡æ¯å­—æ®µä¹Ÿä¸æ­£ç¡®ï¼š
- âŒ é”™è¯¯: `user` (å¸–å­ç”¨è¿™ä¸ª)
- âœ… æ­£ç¡®: `userInfo` (è¯„è®ºç”¨è¿™ä¸ª)

### å—å½±å“çš„æ–‡ä»¶
1. `68c71d50000000001c005084.json` - ğŸŒŸç¡…è°·åƒé¥­æ— è¶£æ˜Ÿäºº...
2. `680d561a000000000f033dbc.json` - ã€Cupertinoé¤å…ã€‘...
3. `690c40bf0000000005039eae.json` - æ¹¾åŒºä¸€å¹´åƒå¥½é¥­...
4. `697a7529000000000b0111ab.json` - æ¥ç¾10å¹´...
5. `689632250000000025023b2c.json` - é›å¨ƒå¹²é¥­æŒ‡å—...
6. `697ad7a0000000000c035eb3.json` - æˆéƒ½äººå››åˆ·...
7. `6923764a000000001f00cd7c.json` - åœ¨æ¹¾åŒºåƒè¿‡çš„æœ€å¥½çš„çƒ¤æ´»é±¼
8. `67ba7dae00000000290119d8.json` - æ¹¾åŒºä¸­é¤è¶…å…¨è¶…çœŸè¯šæ¨è
9. `6856cc340000000013011fd6.json` - æ¹¾åŒºï½œä¸¤å‘¨åƒéæ¹¾åŒºä¸­é¤
10. `67f363f0000000001c01ecd5.json` - æ¹¾åŒºç”Ÿæ´»ï½œä¸‰å®¶åƒå®Œå°±æƒ³äºŒåˆ·
... å…±15ä¸ªæ–‡ä»¶

## ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: é‡æ–°é‡‡é›†ï¼ˆæ¨èï¼‰
ä½¿ç”¨ä¿®å¤åçš„è„šæœ¬ `batch_collect_fixed.sh` é‡æ–°é‡‡é›†æ‰€æœ‰æ•°æ®ã€‚

**ä¼˜ç‚¹**:
- æ•°æ®å®Œæ•´ã€ä¸€è‡´
- ç¬¦åˆæœ€æ–°Schemaè§„èŒƒ

**ç¼ºç‚¹**:
- éœ€è¦é‡æ–°é‡‡é›†å…¨éƒ¨21æ¡å¸–å­
- è€—æ—¶è¾ƒé•¿ï¼ˆé¢„è®¡30-60åˆ†é’Ÿï¼‰

### æ–¹æ¡ˆ2: å¢é‡ä¿®å¤
ä»…é‡æ–°é‡‡é›†è¯„è®ºæ•°æ®ï¼Œä¿ç•™å·²æœ‰çš„å¸–å­æ•°æ®ã€‚

**ä¼˜ç‚¹**:
- èŠ‚çœæ—¶é—´
- å¸–å­æ•°æ®æ— éœ€é‡æ–°è·å–

**ç¼ºç‚¹**:
- éœ€è¦å•ç‹¬å¤„ç†è¯„è®º
- æ•°æ®å¯èƒ½ä¸ä¸€è‡´

## æ¨èæ“ä½œ

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°é‡‡é›†æ‰€æœ‰æ•°æ®ï¼š

```bash
cd /Users/joeli/.openclaw/workspace-planner/projects/bay-area-food-map

# 1. å¤‡ä»½ç°æœ‰æ•°æ®
mv data/raw/v2 data/raw/v2_backup

# 2. é‡æ–°åˆ›å»ºç›®å½•
mkdir -p data/raw/v2/{posts,comments,authors}

# 3. ä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬é‡æ–°é‡‡é›†
bash scripts/batch_collect_fixed.sh
```

## æ•°æ®Schemaæ›´æ–°

å·²æ›´æ–° `docs/DATA_SCHEMA_V2.md` æ˜ç¡®ä»¥ä¸‹å­—æ®µæ˜ å°„ï¼š

### è¯„è®ºå­—æ®µæ˜ å°„
| APIå­—æ®µ | Schemaå­—æ®µ | è¯´æ˜ |
|---------|------------|------|
| `id` | `comment_id` | è¯„è®ºå”¯ä¸€ID |
| `noteId` | `note_id` | å¸–å­ID |
| `parentCommentId` | `parent_id` | çˆ¶è¯„è®ºID |
| `content` | `content` | è¯„è®ºå†…å®¹ |
| `createTime` | `create_time` | åˆ›å»ºæ—¶é—´ |
| `userInfo.userId` | `author.user_id` | ä½œè€…ID |
| `userInfo.nickname` | `author.nickname` | ä½œè€…æ˜µç§° |
| `likeCount` | `interaction.liked_count` | ç‚¹èµæ•° |
| `subCommentCount` | `interaction.reply_count` | å›å¤æ•° |
| `subComments` | `sub_comments` | å­è¯„è®ºåˆ—è¡¨ |

### å­è¯„è®ºå­—æ®µæ˜ å°„
| APIå­—æ®µ | Schemaå­—æ®µ | è¯´æ˜ |
|---------|------------|------|
| `id` | `comment_id` | å›å¤å”¯ä¸€ID |
| `content` | `content` | å›å¤å†…å®¹ |
| `createTime` | `create_time` | åˆ›å»ºæ—¶é—´ |
| `userInfo.userId` | `author.user_id` | ä½œè€…ID |
| `likeCount` | `interaction.liked_count` | ç‚¹èµæ•° |

## å»é‡é€»è¾‘

ä½¿ç”¨ `comment_id` ä½œä¸ºä¸»é”®è¿›è¡Œå»é‡ï¼š

```python
# å…¨å±€å”¯ä¸€é”®
global_key = f"{note_id}:{comment_id}"

# å»é‡æ£€æŸ¥
if global_key in existing_set:
    # å·²å­˜åœ¨ï¼Œå¯é€‰æ‹©æ›´æ–°æˆ–è·³è¿‡
    pass
else:
    # æ–°è¯„è®ºï¼Œæ·»åŠ åˆ°é›†åˆ
    existing_set.add(global_key)
    save_comment(comment)
```

## åç»­æ­¥éª¤

1. [ ] æ‰§è¡Œé‡æ–°é‡‡é›†
2. [ ] éªŒè¯æ–°æ•°æ®çš„å®Œæ•´æ€§
3. [ ] ç¡®ä¿æ‰€æœ‰comment_idå­—æ®µæ­£ç¡®
4. [ ] åˆ é™¤å¤‡ä»½æ•°æ®ï¼ˆç¡®è®¤æ— è¯¯åï¼‰
5. [ ] ç»§ç»­é‡‡é›†å‰©ä½™70æ¡å¸–å­
