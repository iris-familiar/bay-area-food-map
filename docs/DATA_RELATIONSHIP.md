# æ•°æ®æ–‡ä»¶å…³ç³»å›¾è°±
## æ¹¾åŒºç¾é£Ÿåœ°å›¾é¡¹ç›®

âš ï¸ **è­¦å‘Š**: ä¿®æ”¹æ­¤æ–‡ä»¶å‰å¿…é¡»é˜…è¯»æœ¬æ–‡æ¡£ï¼Œäº†è§£æ–‡ä»¶ä¾èµ–å…³ç³»ï¼

---

## ğŸ“Š æ ¸å¿ƒæ•°æ®æ–‡ä»¶å…³ç³»

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Single Source of Truth             â”‚
                        â”‚  å”¯ä¸€æ•°æ®æº                         â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                      â”‚                      â”‚
                    â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ restaurant_database.json â”‚  â”‚ corrections.json        â”‚  â”‚ quality_rules.json      â”‚
â”‚ â†³ Symlink to actual file â”‚  â”‚ â†³ ä¿®æ­£è®°å½•              â”‚  â”‚ â†³ è´¨é‡è§„åˆ™              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Symbolic Link (å¿…é¡»ä¿æŒ!)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ restaurant_database_v{VERSION}.json â”‚
â”‚ â†³ å®é™…æ•°æ®æ–‡ä»¶ï¼ˆå½“å‰: v5_standardizedï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— å…³é”®ä¾èµ–å…³ç³»

### 1. æ•°æ®åº“æ–‡ä»¶é“¾
```
restaurant_database.json (symlink)
    â””â”€â”€ restaurant_database_v5_standardized.json (actual file)
```

**ä¾èµ–æ–¹**:
- `index.html` - é€šè¿‡ `fetch('data/current/restaurant_database.json')`
- `scripts/*.js` - æ‰€æœ‰æ•°æ®å¤„ç†è„šæœ¬
- `tests/e2e/*.spec.ts` - æµ‹è¯•æ–‡ä»¶

**è§„åˆ™**: 
- âŒ æ°¸è¿œä¸è¦ç›´æ¥åˆ›å»ºæ–°çš„æ•°æ®åº“æ–‡ä»¶è€Œä¸æ›´æ–° symlink
- âŒ æ°¸è¿œä¸è¦åˆ é™¤æˆ–é‡å‘½å symlink ç›®æ ‡è€Œä¸æ›´æ–° symlink
- âœ… ä¿®æ”¹æ•°æ®å‰å¿…é¡»å…ˆå¤‡ä»½æ—§ç‰ˆæœ¬
- âœ… æ–°ç‰ˆæœ¬å¿…é¡»ä½¿ç”¨ç‰ˆæœ¬å·å‘½å (v{N}_{DESCRIPTION}.json)

---

### 2. HTML â†” æ•°æ®åº“å­—æ®µæ˜ å°„

| HTML/JS ä½¿ç”¨ | æ•°æ®åº“å­—æ®µ | å¤‡æ³¨ |
|-------------|-----------|------|
| `r.region` | `region` | åŒºåŸŸ (South Bay, Peninsula, etc) |
| `r.city` | `city` | åŸå¸‚ (Fremont, Sunnyvale, etc) |
| `r.area` | `area` | æ—§å­—æ®µï¼Œå‘åå…¼å®¹ä¿ç•™ |
| `r.engagement` | `engagement` | è®¨è®ºåº¦ |
| `r.sentiment_score` | `sentiment_score` | å£ç¢‘åˆ†æ•° |
| `r.xiaohongshu_id` | `xiaohongshu_id` | å°çº¢ä¹¦ID |

**å…¼å®¹æ€§è§„åˆ™**:
- HTML ä»£ç å¿…é¡»åŒæ—¶å…¼å®¹æ–°æ—§å­—æ®µ
- ä¼˜å…ˆä½¿ç”¨æ–°å­—æ®µï¼Œå›é€€åˆ°æ—§å­—æ®µ

```javascript
// æ­£ç¡®çš„å…¼å®¹æ€§å†™æ³•
const region = r.region || r.area || 'æœªçŸ¥åŒºåŸŸ';
const city = r.city || r.area || '';
```

---

### 3. Region ç­›é€‰å™¨æ˜ å°„

**Dropdown Values** â†’ **Data Format**
```javascript
const regionValueMap = {
    'south-bay': 'South Bay',
    'east-bay': 'East Bay', 
    'peninsula': 'Peninsula',
    'sf': 'SF'
};
```

**ä¿®æ”¹ Region æ—¶å¿…é¡»åŒæ—¶æ›´æ–°**:
1. HTML ä¸‹æ‹‰é€‰é¡¹
2. `regionValueMap` æ˜ å°„
3. `regionCities` åŸå¸‚åˆ—è¡¨

---

## âš ï¸ å˜æ›´æ£€æŸ¥æ¸…å•

### åˆ›å»ºæ–°æ•°æ®æ–‡ä»¶å‰å¿…é¡»æ£€æŸ¥:
- [ ] æ˜¯å¦æœ‰ symlink æŒ‡å‘æ—§æ–‡ä»¶?
- [ ] å“ªäº›è„šæœ¬å¼•ç”¨äº†è¯¥æ–‡ä»¶?
- [ ] HTML ä¸­æ˜¯å¦æœ‰ç¡¬ç¼–ç è·¯å¾„?
- [ ] æµ‹è¯•æ–‡ä»¶æ˜¯å¦ä¾èµ–ç‰¹å®šè·¯å¾„?

### ä¿®æ”¹æ•°æ®åº“å­—æ®µå‰å¿…é¡»æ£€æŸ¥:
- [ ] HTML/JS ä¸­ä½¿ç”¨äº†è¯¥å­—æ®µå—?
- [ ] æ˜¯å¦éœ€è¦å‘åå…¼å®¹æ—§å­—æ®µ?
- [ ] ç­›é€‰å™¨æ˜¯å¦ä¾èµ–è¯¥å­—æ®µ?
- [ ] Modal æ˜¾ç¤ºæ˜¯å¦ä½¿ç”¨è¯¥å­—æ®µ?

### é‡å‘½å/åˆ é™¤æ–‡ä»¶å‰å¿…é¡»æ£€æŸ¥:
- [ ] æ›´æ–°æ‰€æœ‰ symlink
- [ ] æ›´æ–°æ‰€æœ‰è„šæœ¬å¼•ç”¨
- [ ] æ›´æ–° HTML ä¸­çš„è·¯å¾„
- [ ] æ›´æ–°æµ‹è¯•æ–‡ä»¶
- [ ] åˆ›å»ºå¤‡ä»½

---

## ğŸ›¡ï¸ è‡ªåŠ¨åŒ–é˜²æŠ¤

### 1. æ–‡ä»¶å…³ç³»æ£€æŸ¥è„šæœ¬
```bash
# æ£€æŸ¥ symlink å®Œæ•´æ€§
scripts/check_file_integrity.sh
```

### 2. å­—æ®µä¸€è‡´æ€§æ£€æŸ¥
```bash
# éªŒè¯æ•°æ®åº“å­—æ®µä¸ä»£ç æœŸæœ›ä¸€è‡´
scripts/check_field_compatibility.js
```

### 3. è·¯å¾„ä¸€è‡´æ€§æ£€æŸ¥
```bash
# ç¡®ä¿æ‰€æœ‰ä»£ç ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“è·¯å¾„
grep -r "restaurant_database" scripts/ index.html tests/
```

---

## ğŸ“ å†å²æ•™è®­

### 2026-02-17 - æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´é”™è¯¯
**é—®é¢˜**: åˆ›å»ºäº† `v5_standardized.json` ä½†æ²¡æœ‰æ›´æ–° symlinkï¼Œå¯¼è‡´ HTML ä»åŠ è½½æ—§æ–‡ä»¶ `v5_ui.json`

**å½±å“**: ç½‘ç«™æ˜¾ç¤º"æ­£åœ¨åŠ è½½"ï¼Œæ•°æ®ä¸æ›´æ–°

**ä¿®å¤**: 
1. æ›´æ–° symlink æŒ‡å‘æ–°æ–‡ä»¶
2. ä¿®æ”¹ HTML ä¸­çš„ç¡¬ç¼–ç è·¯å¾„
3. æ›´æ–°æ‰€æœ‰è„šæœ¬å¼•ç”¨
4. å»ºç«‹æœ¬æ–‡æ¡£é˜²æ­¢å†çŠ¯

**é¢„é˜²**:
- âœ… å»ºç«‹ `DATA_RELATIONSHIP.md`
- âœ… åˆ›å»ºå˜æ›´æ£€æŸ¥æ¸…å•
- âœ… æ·»åŠ å®Œæ•´æ€§æ£€æŸ¥è„šæœ¬

---

## ğŸ”„ æ ‡å‡†å˜æ›´æµç¨‹

### 1. ä¿®æ”¹æ•°æ®å‰
```bash
# 1. å¤‡ä»½æ—§æ•°æ®
cp data/current/restaurant_database_v{N}.json data/backup/

# 2. æ£€æŸ¥æ–‡ä»¶å…³ç³»
./scripts/check_file_integrity.sh

# 3. åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆä½¿ç”¨ç‰ˆæœ¬å·ï¼‰
# data/current/restaurant_database_v{N+1}_{DESCRIPTION}.json
```

### 2. æ›´æ–° symlink
```bash
# 4. æ›´æ–° symlink
cd data/current
ln -sf restaurant_database_v{N+1}_{DESCRIPTION}.json restaurant_database.json
```

### 3. éªŒè¯ä¾èµ–
```bash
# 5. æ£€æŸ¥æ‰€æœ‰å¼•ç”¨
./scripts/check_field_compatibility.js

# 6. è¿è¡Œæµ‹è¯•
npm test
```

### 4. éƒ¨ç½²å‰
```bash
# 7. å®Œæ•´ E2E æµ‹è¯•
./scripts/e2e-smoke-test.js

# 8. æµè§ˆå™¨éªŒè¯
# æ‰‹åŠ¨æ‰“å¼€ http://localhost:8080 æ£€æŸ¥
```

---

**æœ€åæ›´æ–°**: 2026-02-17  
**è´£ä»»äºº**: Travis  
**å®¡æ ¸äºº**: (å¾…å°‘çˆ·ç¡®è®¤)
