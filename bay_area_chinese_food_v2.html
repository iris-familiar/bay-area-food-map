<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¹¾åŒºä¸­é¤ç¾é£Ÿåœ°å›¾ V2 | æ·±åº¦ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .tag { transition: all 0.2s ease; }
        .tag:hover { transform: scale(1.05); }
        .filter-active { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .gradient-text { background: linear-gradient(135deg, #ef4444 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .status-recommended { border-left: 4px solid #10b981; }
        .status-not-recommended { border-left: 4px solid #ef4444; }
        .status-warning { border-left: 4px solid #f59e0b; }
        .comment-bubble { background: #f3f4f6; border-radius: 12px; position: relative; }
        .comment-bubble::before { content: ''; position: absolute; left: -8px; top: 12px; border: 8px solid transparent; border-right-color: #f3f4f6; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="sticky top-0 z-50 glass border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-orange-500 rounded-xl flex items-center justify-center text-white text-2xl">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold gradient-text">æ¹¾åŒºä¸­é¤ç¾é£Ÿåœ°å›¾ V2</h1>
                        <p class="text-sm text-gray-500">åŸºäºå°çº¢ä¹¦æ·±åº¦æ•°æ®åˆ†æ | å«çœŸå®è¯„è®º</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-sm text-gray-600">
                        <span class="font-semibold text-red-600" id="total-restaurants">0</span> å®¶é¤å…
                    </div>
                    <button onclick="toggleStats()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition">
                        <i class="fas fa-chart-bar mr-2"></i>ç»Ÿè®¡
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Filters -->
        <div class="bg-white rounded-2xl shadow-sm p-6 mb-8">
            <div class="flex flex-wrap gap-3 mb-4">
                <span class="text-gray-600 font-medium py-2">èœç³»ç±»å‹ï¼š</span>
                <button onclick="filterByType('all')" class="filter-btn filter-active px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-type="all">å…¨éƒ¨</button>
                <button onclick="filterByType('å·èœ')" class="filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-type="å·èœ">ğŸŒ¶ï¸ å·èœ</button>
                <button onclick="filterByType('æ¹˜èœ')" class="filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-type="æ¹˜èœ">ğŸ”¥ æ¹˜èœ</button>
                <button onclick="filterByType('ç²¤èœ')" class="filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-type="ç²¤èœ">ğŸ¥Ÿ ç²¤èœ</button>
                <button onclick="filterByType('ä¸Šæµ·èœ')" class="filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-type="ä¸Šæµ·èœ">ğŸœ ä¸Šæµ·èœ</button>
                <button onclick="filterByType('ä¸œåŒ—èœ')" class="filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-type="ä¸œåŒ—èœ">ğŸ¥˜ ä¸œåŒ—èœ</button>
            </div>
            <div class="flex flex-wrap gap-3">
                <span class="text-gray-600 font-medium py-2">åŒºåŸŸï¼š</span>
                <button onclick="filterByArea('all')" class="area-btn filter-active px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-area="all">å…¨éƒ¨</button>
                <button onclick="filterByArea('å—æ¹¾')" class="area-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-area="å—æ¹¾">å—æ¹¾</button>
                <button onclick="filterByArea('æ—§é‡‘å±±')" class="area-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-area="æ—§é‡‘å±±">æ—§é‡‘å±±</button>
                <button onclick="filterByArea('ä¸œæ¹¾')" class="area-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-area="ä¸œæ¹¾">ä¸œæ¹¾</button>
                <button onclick="filterByArea('åŠå²›')" class="area-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-area="åŠå²›">åŠå²›</button>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-100">
                <div class="flex flex-wrap gap-2 mb-3">
                    <span class="text-gray-600 font-medium py-2">å£ç¢‘ï¼š</span>
                    <button onclick="filterByStatus('all')" class="status-btn filter-active px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium transition" data-status="all">å…¨éƒ¨</button>
                    <button onclick="filterByStatus('recommended')" class="status-btn px-4 py-2 rounded-full bg-gray-100 text-green-700 text-sm font-medium transition" data-status="recommended">âœ… æ¨è</button>
                    <button onclick="filterByStatus('not_recommended')" class="status-btn px-4 py-2 rounded-full bg-gray-100 text-red-700 text-sm font-medium transition" data-status="not_recommended">âŒ é¿é›·</button>
                    <button onclick="filterByStatus('warning')" class="status-btn px-4 py-2 rounded-full bg-gray-100 text-yellow-700 text-sm font-medium transition" data-status="warning">âš ï¸ æ³¨æ„</button>
                </div>
                <div class="flex gap-2">
                    <input type="text" id="search-input" placeholder="æœç´¢é¤å…åç§°ã€èœå“æˆ–å…³é”®è¯..." 
                           class="flex-1 px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                    <button onclick="searchRestaurants()" class="px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Dashboard -->
        <div id="stats-panel" class="hidden bg-white rounded-2xl shadow-sm p-6 mb-8">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <i class="fas fa-chart-pie text-red-500"></i> æ•°æ®ç»Ÿè®¡
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 text-center">
                    <div class="text-3xl font-bold text-green-600" id="stat-recommended">0</div>
                    <div class="text-sm text-gray-600">æ¨èé¤å…</div>
                </div>
                <div class="bg-gradient-to-br from-red-50 to-rose-50 rounded-xl p-4 text-center">
                    <div class="text-3xl font-bold text-red-600" id="stat-not-recommended">0</div>
                    <div class="text-sm text-gray-600">é¿é›·é¤å…</div>
                </div>
                <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-4 text-center">
                    <div class="text-3xl font-bold text-yellow-600" id="stat-warning">0</div>
                    <div class="text-sm text-gray-600">éœ€æ³¨æ„</div>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 text-center">
                    <div class="text-3xl font-bold text-blue-600" id="stat-from-comments">0</div>
                    <div class="text-sm text-gray-600">æ¥è‡ªçœŸå®è¯„è®º</div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-4">
                    <canvas id="cuisineChart"></canvas>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Sort Options -->
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-gray-800">é¤å…åˆ—è¡¨</h2>
            <div class="flex gap-2">
                <select id="sort-select" onchange="sortRestaurants()" class="px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                    <option value="popular">ğŸ”¥ æŒ‰çƒ­åº¦æ’åº</option>
                    <option value="likes">â¤ï¸ æŒ‰ç‚¹èµæ•°</option>
                </select>
            </div>
        </div>

        <!-- Restaurant Grid -->
        <div id="restaurant-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Cards will be inserted here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-16">
            <div class="text-6xl mb-4">ğŸœ</div>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¤å…</h3>
            <p class="text-gray-500">è¯•ç€è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æœç´¢å…¶ä»–å…³é”®è¯</p>
        </div>
    </main>

    <!-- Detail Modal -->
    <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto animate-fade-in">
            <div class="sticky top-0 bg-white border-b border-gray-100 p-4 flex justify-between items-center">
                <h3 id="modal-title" class="text-xl font-bold"></h3>
                <button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modal-content" class="p-6">
                <!-- Content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Restaurant Data - Extracted from detailed comments
        const restaurants = [
            {
                id: "r001",
                name: "é¦™é”…å¤§ç‹",
                name_en: "Xiang Guo Da Wang",
                type: "æ¹˜èœ",
                cuisine: "æ¹–å—èœ",
                area: "æ—§é‡‘å±±",
                location: "SF",
                address: "",
                popularity: { likes: 11, comment: "å¿«å»åƒsfçš„é‚£å®¶é¦™é”…å¤§ç‹çš„æ¹˜èœ æˆ‘çš„å— æˆ‘çš„å§¥ æˆ‘çš„å¤§è„‘å˜å¤§æ£ å¤–å–å·²ç»å¥½åƒåˆ°å®¶äº† å ‚åƒæ¯”å¤–å–å¥½åƒä¸€ç™¾å€ é”…å…¶è¶…è¶³" },
                highlights: ["æ¹˜èœ", "é¦™é”…", "é”…æ°”è¶³"],
                recommendations: ["é¦™é”…"],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "recommended"
            },
            {
                id: "r002",
                name: "ç‹å®¶å«",
                name_en: "Wang Jia Wei",
                type: "ä¸œåŒ—èœ",
                cuisine: "ä¸œåŒ—èœ",
                area: "",
                location: "",
                address: "",
                popularity: { likes: 22, comment: "ä¸œåŒ—äººæ¨èä¸€ä¸‹ä¸œåŒ—èœ ç‹å®¶å«çš„é”…åŒ…è‚‰ é…¸èœç™½è‚‰å’Œfremont acekingçš„éº»è¾£çƒ« æ˜¯æœ¬ä¸œåŒ—äººçš„comfort food" },
                highlights: ["ä¸œåŒ—èœ", "é”…åŒ…è‚‰", "é…¸èœç™½è‚‰"],
                recommendations: ["é”…åŒ…è‚‰", "é…¸èœç™½è‚‰"],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "recommended"
            },
            {
                id: "r003",
                name: "Acekingéº»è¾£çƒ«",
                name_en: "Aceking",
                type: "éº»è¾£çƒ«",
                cuisine: "éº»è¾£çƒ«",
                area: "ä¸œæ¹¾",
                location: "Fremont",
                address: "",
                popularity: { likes: 22, comment: "fremont acekingçš„éº»è¾£çƒ« æ˜¯æœ¬ä¸œåŒ—äººçš„comfort food" },
                highlights: ["éº»è¾£çƒ«", "ä¸œåŒ—äººæ¨è"],
                recommendations: ["éº»è¾£çƒ«"],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "recommended"
            },
            {
                id: "r004",
                name: "Yuan Bistro",
                name_en: "Yuan Bistro",
                type: "ä¸­é¤",
                cuisine: "",
                area: "",
                location: "",
                address: "",
                popularity: { likes: 0, comment: "yuan bistroå¥½åƒ" },
                highlights: ["å¥½åƒ"],
                recommendations: [],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "recommended"
            },
            {
                id: "r005",
                name: "å¡”é‡Œæœ¨",
                name_en: "Tarim",
                type: "æ–°ç–†èœ",
                cuisine: "æ–°ç–†èœ",
                area: "å—æ¹¾",
                location: "Santa Clara",
                address: "",
                popularity: { likes: 15, comment: "æ–°ç–†èœå¿…é¡»åŠ ä¸Šå¡”é‡Œæœ¨å•Š santa clara" },
                highlights: ["æ–°ç–†èœ", "Santa Clara"],
                recommendations: [],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "recommended"
            },
            {
                id: "r006",
                name: "Z&Y Restaurant",
                name_en: "Z&Y",
                type: "å·èœ",
                cuisine: "å·èœ",
                area: "æ—§é‡‘å±±",
                location: "SF Chinatown",
                address: "",
                popularity: { likes: 18, comment: "æ—§é‡‘å±±chinatowné‚£ä¸ªz&yçƒ‚å®Œäº†å·²ç»" },
                highlights: ["å·èœ", "Chinatown"],
                recommendations: [],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "not_recommended",
                warnings: ["è´¨é‡ä¸‹é™", "çƒ‚å®Œäº†"]
            },
            {
                id: "r007",
                name: "å†¯æ ¡é•¿",
                name_en: "Feng Xiao Zhang",
                type: "å·èœ",
                cuisine: "å·èœ",
                area: "",
                location: "",
                address: "",
                popularity: { likes: 1, comment: "å†¯æ ¡é•¿å›å›½å¾ˆå¥½åƒï¼Œz&yçš„ç¡®æ˜¯æ¹¾åŒºå·èœå¤©èŠ±æ¿" },
                highlights: ["å·èœ", "å›å›½"],
                recommendations: [],
                source_post: "6868c74123000000001d0186fd",
                from_comment: true,
                status: "recommended"
            },
            {
                id: "r008",
                name: "Henry Hunan",
                name_en: "Henry Hunan",
                type: "æ¹˜èœ",
                cuisine: "æ¹–å—èœ",
                area: "æ—§é‡‘å±±",
                location: "SF",
                address: "",
                popularity: { likes: 0, comment: "Henry hunanç–«æƒ…ä»¥åä¸æ˜¯å·²ç»å…³é—¨äº†å˜›" },
                highlights: [],
                recommendations: [],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "closed",
                warnings: ["å¯èƒ½å·²å…³é—¨"]
            },
            {
                id: "r009",
                name: "Chef Zhao è€èµµå·èœ",
                name_en: "Chef Zhao",
                type: "å·èœ",
                cuisine: "å·èœ",
                area: "åŠå²›",
                location: "San Carlos",
                address: "",
                popularity: { likes: 0, comment: "Chef zhaoä»¥å‰å«ç”Ÿæœ‰é—®é¢˜" },
                highlights: [],
                recommendations: [],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "warning",
                warnings: ["å«ç”Ÿé—®é¢˜"]
            },
            {
                id: "r010",
                name: "é˜¿æ‹‰ä¸Šæµ·",
                name_en: "I Shanghai Delight",
                type: "ä¸Šæµ·èœ",
                cuisine: "ä¸Šæµ·èœ",
                area: "ä¸œæ¹¾",
                location: "Fremont",
                address: "",
                popularity: { likes: 0, comment: "fremontçš„i shanghai delighté˜¿æ‹‰ä¸Šæµ·ï¼Œæ —å­é¹Œé¹‘è›‹çº¢çƒ§è‚‰å’Œç”Ÿç…æŒºå¥½åƒçš„" },
                highlights: ["ä¸Šæµ·èœ", "çº¢çƒ§è‚‰", "ç”Ÿç…"],
                recommendations: ["æ —å­é¹Œé¹‘è›‹çº¢çƒ§è‚‰", "ç”Ÿç…"],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "recommended"
            },
            {
                id: "r011",
                name: "Shanghai Flavor",
                name_en: "Shanghai Flavor",
                type: "ä¸Šæµ·èœ",
                cuisine: "ä¸Šæµ·èœ",
                area: "",
                location: "",
                address: "",
                popularity: { likes: 1, comment: "æ€ä¹ˆèƒ½æ²¡æœ‰shanghai flavor" },
                highlights: ["ä¸Šæµ·èœ"],
                recommendations: [],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "recommended"
            },
            {
                id: "r012",
                name: "Kabul Afghan",
                name_en: "Kabul Afghan",
                type: "é˜¿å¯Œæ±—èœ",
                cuisine: "é˜¿å¯Œæ±—èœ",
                area: "",
                location: "",
                address: "Blueskyéš”å£",
                popularity: { likes: 2, comment: "blueskyéš”å£æœ‰ä¸ªkabul afghané¦†å­è¿˜ä¸é”™" },
                highlights: ["é˜¿å¯Œæ±—èœ", "Blueskyéš”å£"],
                recommendations: [],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "recommended"
            },
            {
                id: "r013",
                name: "é¡¾ä¹¡",
                name_en: "Gu Xiang",
                type: "ä¸­é¤",
                cuisine: "",
                area: "",
                location: "",
                address: "",
                popularity: { likes: 0, comment: "é¡¾ä¹¡" },
                highlights: [],
                recommendations: [],
                source_post: "68c74123000000001d0186fd",
                from_comment: true,
                status: "neutral"
            }
        ];

        let filteredRestaurants = [...restaurants];
        let currentType = 'all';
        let currentArea = 'all';
        let currentStatus = 'all';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderRestaurants();
            updateStats();
            initCharts();
        });

        // Get status color and icon
        function getStatusStyle(status) {
            const styles = {
                'recommended': { color: 'bg-green-100 text-green-700', icon: 'âœ…', label: 'æ¨è' },
                'not_recommended': { color: 'bg-red-100 text-red-700', icon: 'âŒ', label: 'é¿é›·' },
                'warning': { color: 'bg-yellow-100 text-yellow-700', icon: 'âš ï¸', label: 'æ³¨æ„' },
                'closed': { color: 'bg-gray-100 text-gray-700', icon: 'ğŸš«', label: 'å·²å…³é—¨' },
                'neutral': { color: 'bg-blue-100 text-blue-700', icon: 'â–', label: 'ä¸€èˆ¬' }
            };
            return styles[status] || styles['neutral'];
        }

        // Get status border class
        function getStatusBorder(status) {
            const borders = {
                'recommended': 'status-recommended',
                'not_recommended': 'status-not-recommended',
                'warning': 'status-warning',
                'closed': 'border-l-4 border-gray-400',
                'neutral': 'border-l-4 border-blue-400'
            };
            return borders[status] || borders['neutral'];
        }

        // Render restaurants
        function renderRestaurants() {
            const grid = document.getElementById('restaurant-grid');
            const emptyState = document.getElementById('empty-state');
            
            if (filteredRestaurants.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            grid.innerHTML = filteredRestaurants.map(r => {
                const statusStyle = getStatusStyle(r.status);
                const statusBorder = getStatusBorder(r.status);
                
                return `
                <div class="bg-white rounded-2xl shadow-sm overflow-hidden card-hover animate-fade-in cursor-pointer ${statusBorder}" onclick="showDetail('${r.id}')">
                    <div class="h-48 bg-gradient-to-br from-red-100 to-orange-100 flex items-center justify-center relative">
                        <div class="text-6xl">${getTypeEmoji(r.type)}</div>
                        <div class="absolute top-3 right-3 ${statusStyle.color} rounded-full px-3 py-1 text-sm font-semibold shadow-sm">
                            ${statusStyle.icon} ${statusStyle.label}
                        </div>
                        ${r.from_comment ? '<div class="absolute bottom-3 right-3 bg-blue-500 text-white rounded-full px-2 py-1 text-xs">ğŸ’¬ æ¥è‡ªè¯„è®º</div>' : ''}
                    </div>
                    <div class="p-5">
                        <h3 class="text-lg font-bold text-gray-800 mb-1">${r.name}</h3>
                        ${r.name_en ? `<p class="text-xs text-gray-400 mb-2">${r.name_en}</p>` : ''}
                        <div class="flex items-center gap-2 mb-3">
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">${r.type}</span>
                            ${r.area ? `<span class="px-2 py-1 bg-red-50 text-red-600 text-xs rounded">${r.area}</span>` : ''}
                            ${r.location ? `<span class="text-xs text-gray-400">${r.location}</span>` : ''}
                        </div>
                        
                        ${r.recommendations.length > 0 ? `
                        <div class="flex flex-wrap gap-1 mb-3">
                            ${r.recommendations.map(dish => `
                                <span class="tag px-2 py-1 bg-orange-100 text-orange-700 text-xs rounded-full">ğŸ‘ ${dish}</span>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        ${r.warnings ? `
                        <div class="bg-red-50 rounded-lg p-2 mb-3">
                            <p class="text-xs text-red-600">âš ï¸ ${r.warnings.join('ã€')}</p>
                        </div>
                        ` : ''}
                        
                        <div class="flex items-center justify-between text-sm text-gray-600 border-t border-gray-100 pt-3">
                            <span class="flex items-center gap-1"><i class="fas fa-heart text-red-400"></i> ${r.popularity.likes} ç‚¹èµ</span>
                            <span class="text-xs text-gray-400">æŸ¥çœ‹è¯¦æƒ… â†’</span>
                        </div>
                    </div>
                </div>
            `}).join('');
            
            document.getElementById('total-restaurants').textContent = filteredRestaurants.length;
        }

        // Get emoji for type
        function getTypeEmoji(type) {
            const emojiMap = {
                'å·èœ': 'ğŸŒ¶ï¸',
                'æ¹˜èœ': 'ğŸ”¥',
                'ç²¤èœ': 'ğŸ¥Ÿ',
                'ä¸Šæµ·èœ': 'ğŸœ',
                'ä¸œåŒ—èœ': 'ğŸ¥˜',
                'éº»è¾£çƒ«': 'ğŸ²',
                'æ–°ç–†èœ': 'ğŸ¥©',
                'é˜¿å¯Œæ±—èœ': 'ğŸ›',
                'ä¸­é¤': 'ğŸ±',
                'ç»¼åˆ': 'ğŸ½ï¸'
            };
            return emojiMap[type] || 'ğŸ½ï¸';
        }

        // Filter by type
        function filterByType(type) {
            currentType = type;
            applyFilters();
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.type === type) {
                    btn.classList.add('filter-active');
                } else {
                    btn.classList.remove('filter-active');
                }
            });
        }

        // Filter by area
        function filterByArea(area) {
            currentArea = area;
            applyFilters();
            
            document.querySelectorAll('.area-btn').forEach(btn => {
                if (btn.dataset.area === area) {
                    btn.classList.add('filter-active');
                } else {
                    btn.classList.remove('filter-active');
                }
            });
        }

        // Filter by status
        function filterByStatus(status) {
            currentStatus = status;
            applyFilters();
            
            document.querySelectorAll('.status-btn').forEach(btn => {
                if (btn.dataset.status === status) {
                    btn.classList.add('filter-active');
                } else {
                    btn.classList.remove('filter-active');
                }
            });
        }

        // Apply filters
        function applyFilters() {
            filteredRestaurants = restaurants.filter(r => {
                const typeMatch = currentType === 'all' || r.type === currentType || r.cuisine === currentType;
                const areaMatch = currentArea === 'all' || r.area === currentArea;
                const statusMatch = currentStatus === 'all' || r.status === currentStatus;
                return typeMatch && areaMatch && statusMatch;
            });
            renderRestaurants();
        }

        // Search
        function searchRestaurants() {
            const query = document.getElementById('search-input').value.toLowerCase();
            if (!query) {
                applyFilters();
                return;
            }
            
            filteredRestaurants = restaurants.filter(r => 
                r.name.toLowerCase().includes(query) ||
                r.name_en.toLowerCase().includes(query) ||
                r.popularity.comment.toLowerCase().includes(query) ||
                r.recommendations.some(dish => dish.toLowerCase().includes(query)) ||
                r.location.toLowerCase().includes(query)
            );
            renderRestaurants();
        }

        // Sort
        function sortRestaurants() {
            const sortType = document.getElementById('sort-select').value;
            
            filteredRestaurants.sort((a, b) => {
                switch(sortType) {
                    case 'likes': return b.popularity.likes - a.popularity.likes;
                    case 'popular':
                    default: return b.popularity.likes - a.popularity.likes;
                }
            });
            
            renderRestaurants();
        }

        // Show detail modal
        function showDetail(id) {
            const r = restaurants.find(item => item.id === id);
            if (!r) return;
            
            const statusStyle = getStatusStyle(r.status);
            
            document.getElementById('modal-title').textContent = r.name;
            document.getElementById('modal-content').innerHTML = `
                <div class="space-y-4">
                    <div class="h-64 bg-gradient-to-br from-red-100 to-orange-100 rounded-xl flex items-center justify-center">
                        <div class="text-8xl">${getTypeEmoji(r.type)}</div>
                    </div>
                    
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 ${statusStyle.color} rounded-full text-sm font-medium">${statusStyle.icon} ${statusStyle.label}</span>
                        <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">${r.type}</span>
                        ${r.area ? `<span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">${r.area}</span>` : ''}
                        ${r.location ? `<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">${r.location}</span>` : ''}
                    </div>
                    
                    ${r.address ? `<p class="text-gray-600">ğŸ“ ${r.address}</p>` : ''}
                    
                    <div class="bg-gray-50 rounded-xl p-4">
                        <h4 class="font-semibold mb-2">ğŸ’¬ çœŸå®è¯„ä»·</h4>
                        <div class="comment-bubble p-3 ml-4">
                            <p class="text-gray-700 text-sm">"${r.popularity.comment}"</p>
                            <div class="flex items-center gap-2 mt-2 text-xs text-gray-500">
                                <span>â¤ï¸ ${r.popularity.likes} ç‚¹èµ</span>
                                ${r.from_comment ? '<span class="text-blue-500">æ¥è‡ªå°çº¢ä¹¦è¯„è®º</span>' : ''}
                            </div>
                        </div>
                    </div>
                    
                    ${r.recommendations.length > 0 ? `
                    <div>
                        <h4 class="font-semibold mb-2">ğŸ‘¨â€ğŸ³ æ¨èèœå“</h4>
                        <div class="flex flex-wrap gap-2">
                            ${r.recommendations.map(dish => `
                                <span class="px-3 py-2 bg-orange-100 text-orange-700 rounded-lg text-sm font-medium">${dish}</span>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${r.warnings ? `
                    <div class="bg-red-50 rounded-xl p-4 border border-red-200">
                        <h4 class="font-semibold text-red-700 mb-2">âš ï¸ æ³¨æ„äº‹é¡¹</h4>
                        <ul class="space-y-1">
                            ${r.warnings.map(w => `<li class="text-red-600 text-sm">â€¢ ${w}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    ${r.highlights.length > 0 ? `
                    <div>
                        <h4 class="font-semibold mb-2">âœ¨ ç‰¹è‰²äº®ç‚¹</h4>
                        <div class="flex flex-wrap gap-2">
                            ${r.highlights.map(h => `
                                <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-sm">${h}</span>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="bg-blue-50 rounded-xl p-4">
                        <h4 class="font-semibold text-blue-700 mb-1">ğŸ“± æ•°æ®æ¥æº</h4>
                        <p class="text-sm text-blue-600">å°çº¢ä¹¦å¸–å­ "æ¹¾åŒº12å¹´æ”’çš„é¤å…list"</p>
                    </div>
                </div>
            `;
            
            document.getElementById('detail-modal').classList.remove('hidden');
        }

        // Close modal
        function closeModal() {
            document.getElementById('detail-modal').classList.add('hidden');
        }

        // Toggle stats panel
        function toggleStats() {
            const panel = document.getElementById('stats-panel');
            panel.classList.toggle('hidden');
            if (!panel.classList.contains('hidden')) {
                updateStats();
            }
        }

        // Update statistics
        function updateStats() {
            const recommended = restaurants.filter(r => r.status === 'recommended').length;
            const notRecommended = restaurants.filter(r => r.status === 'not_recommended').length;
            const warning = restaurants.filter(r => r.status === 'warning' || r.status === 'closed').length;
            const fromComments = restaurants.filter(r => r.from_comment).length;
            
            document.getElementById('stat-recommended').textContent = recommended;
            document.getElementById('stat-not-recommended').textContent = notRecommended;
            document.getElementById('stat-warning').textContent = warning;
            document.getElementById('stat-from-comments').textContent = fromComments;
        }

        // Initialize charts
        function initCharts() {
            // Cuisine chart
            const cuisineCount = {};
            restaurants.forEach(r => {
                cuisineCount[r.type] = (cuisineCount[r.type] || 0) + 1;
            });
            
            new Chart(document.getElementById('cuisineChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cuisineCount),
                    datasets: [{
                        data: Object.values(cuisineCount),
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981', '#8b5cf6', '#ec4899', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: 'èœç³»åˆ†å¸ƒ' }
                    }
                }
            });
            
            // Status chart
            const statusCount = {
                'æ¨è': restaurants.filter(r => r.status === 'recommended').length,
                'é¿é›·': restaurants.filter(r => r.status === 'not_recommended').length,
                'æ³¨æ„': restaurants.filter(r => r.status === 'warning' || r.status === 'closed').length,
                'ä¸€èˆ¬': restaurants.filter(r => r.status === 'neutral').length
            };
            
            new Chart(document.getElementById('statusChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(statusCount),
                    datasets: [{
                        label: 'é¤å…æ•°é‡',
                        data: Object.values(statusCount),
                        backgroundColor: ['#10b981', '#ef4444', '#f59e0b', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: 'å£ç¢‘åˆ†å¸ƒ' }
                    }
                }
            });
        }

        // Close modal on outside click
        document.getElementById('detail-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeModal();
        });

        // Enter key for search
        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchRestaurants();
        });
    </script>
</body>
</html>
